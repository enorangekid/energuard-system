<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>에너가드 통합 관리 시스템</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div id="loginScreen" class="login-wrapper">
    <div class="login-box">
        <h2>에너가드 통합 관리 시스템</h2>
        <input type="password" id="loginPassInput" class="login-input" placeholder="비밀번호를 입력하세요">
        <button class="login-btn" onclick="tryLogin()">로그인</button>
        <div class="login-options">
            <label><input type="checkbox" id="keepLoginCheck"> 로그인 유지하기</label>
        </div>
        <div id="loginMsg" style="color:#e74c3c; margin-top:15px; font-size:13px; font-weight:bold; min-height:18px;"></div>
    </div>
    <div class="footer-login">
        <span class="company-name">주식회사 에너가드컴퍼니</span>
        ADDRESS : 경기도 포천시 가산면 오성길 146<br>
        TEL : 031-511-0377 &nbsp;|&nbsp; FAX : 031-624-1646 &nbsp;|&nbsp; E-MAIL : mdf24t@naver.com<br>
        Copyright ⓒ 주식회사 에너가드컴퍼니. All Rights Reserved.
    </div>
  </div>

  <div id="loader" class="loader">
    <div class="spinner"></div>
    <span>데이터 동기화 중...</span>
  </div>

  <nav class="sidebar">
    <div class="logo-area"><i class="fa-solid fa-layer-group"></i> EnerGuard</div>
    <ul class="menu-list">
      <li class="menu-item active" onclick="showPage('dashboard', this)"><i class="fa-solid fa-chart-pie"></i> 대시보드</li>
      <li class="menu-item" onclick="showPage('timeline', this)"><i class="fa-solid fa-clock"></i> 업무 타임라인</li>
      <li class="menu-item" onclick="showPage('worklog', this)"><i class="fa-solid fa-calendar-check"></i> 월간 업무일지</li>
      <li class="menu-item" onclick="showPage('productlogs', this)"><i class="fa-solid fa-boxes-packing"></i> 상품 수정 내역</li>
      <li class="menu-item" onclick="showPage('notes', this)"><i class="fa-solid fa-note-sticky"></i> 업무 노트</li>
      <li class="menu-item" onclick="showPage('ranking', this)"><i class="fa-solid fa-trophy"></i> 검색 순위</li>
      <li class="menu-item" onclick="showPage('sales', this)"><i class="fa-solid fa-sack-dollar"></i> 매출 분석</li>
    </ul>
    <div class="sidebar-footer">Version 4.0 Integrated</div>
  </nav>

  <main class="main-content">
    <header class="header">
      <div class="page-title" id="pageTitleText">대시보드</div>
      <div class="header-controls">
        <span id="clock" style="font-feature-settings: 'tnum';">2026.02.11 09:00</span>
        <div style="width:1px; height:16px; background:#e5e7eb;"></div>
        <span>관리자님</span>
        <button class="btn-logout" onclick="handleLogout()"><i class="fa-solid fa-arrow-right-from-bracket"></i></button>
      </div>
    </header>

    <div class="content-body">
      <div id="page-dashboard" class="page-section active">
        <div class="card">
          <h2>👋 안녕하세요, 관리자님!</h2>
          <p style="color:#6b7280;">오늘도 힘차게 업무를 시작해보세요. 좌측 메뉴에서 원하는 기능을 선택하세요.</p>
        </div>
      </div>

      <div id="page-timeline" class="page-section">
        <div class="card input-panel">
          <h3>
            <span>⏱️ 업무 기록</span>
            <div style="display:flex; align-items:center;">
              <div class="search-box" style="position: relative; margin-right: 12px;">
                <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 14px; top: 11px; color: #9ca3af;"></i>
                <input type="text" id="taskSearch" placeholder="기록 검색..." oninput="renderTimeLog()" style="padding: 10px 16px 10px 40px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; width: 220px; background: #f9fafb;">
              </div>
              <select id="yearFilter" onchange="renderTimeLog()" style="padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px; font-weight: 600; margin-right: 12px; cursor: pointer; background: white;">
                <option value="2026">2026년</option>
              </select>
              <button class="btn-server" onclick="saveToServer()"><i class="fa-solid fa-cloud-arrow-up"></i> 전체 저장</button>
            </div>
          </h3>
          <div class="input-group-row">
            <div class="input-wrap small"><label>날짜</label><input type="date" id="tDate" class="form-input"></div>
            <div class="input-wrap small">
              <label>구분</label>
              <select id="tCategory" class="form-input">
                <option value="데일리">데일리</option><option value="광고">광고</option><option value="회의">회의</option>
                <option value="상품등록">상품등록</option><option value="상품수정">상품수정</option><option value="디자인">디자인</option>
                <option value="블로그">블로그</option><option value="유튜브">유튜브</option><option value="과장님업무">과장님업무</option>
                <option value="기타">기타</option><option value="휴무">휴무</option>
              </select>
            </div>
            <div class="input-wrap large"><label>업무 내용</label><input type="text" id="tTask" class="form-input" placeholder="내용을 입력하세요"></div>
            <div class="input-wrap"><label>시작</label><div class="time-split-box"><input type="text" id="tStartH" class="time-part" placeholder="09" maxlength="2"><span style="font-weight: bold; color: #9ca3af;">:</span><input type="text" id="tStartM" class="time-part" placeholder="00" maxlength="2"></div></div>
            <div class="input-wrap"><label>끝</label><div class="time-split-box"><input type="text" id="tEndH" class="time-part" placeholder="18" maxlength="2"><span style="font-weight: bold; color: #9ca3af;">:</span><input type="text" id="tEndM" class="time-part" placeholder="00" maxlength="2"></div></div>
            <button onclick="addTimeLog()" class="btn-add"><i class="fa-solid fa-plus"></i> 등록</button>
          </div>
        </div>
        <div class="card" style="padding:0; overflow:hidden;">
          <table class="timeline-table">
            <thead><tr><th width="100">구분</th><th>업무</th><th width="80">시작</th><th width="80">끝</th><th width="100">소요시간</th><th width="60">삭제</th></tr></thead>
            <tbody id="timelineList"></tbody>
          </table>
        </div>
      </div>

      <div id="page-worklog" class="page-section">
        <div class="worklog-header">
          <div class="header-left">
            <div class="header-icon"><i class="fa-solid fa-calendar-check"></i></div>
            <div>
              <div class="month-display-group">
                <span id="currentMonthDisplay" class="month-text">2026년 02월</span>
                <button class="calendar-trigger-btn" onclick="openHiddenPicker()" title="날짜 변경"><i class="fa-solid fa-calendar-days"></i></button>
                <input type="month" id="hiddenWorklogPicker" style="position:absolute; width:0; height:0; opacity:0; pointer-events:none;" onchange="handleDateChange(this)">
              </div>
              <div style="font-size: 13px; color: #6b7280; margin-top:4px;">Monthly Work Log</div>
            </div>
          </div>
          <button class="btn-server" onclick="collectAndSaveWorklog()" style="background:#111827;"><i class="fa-solid fa-cloud-arrow-up"></i> 저장하기</button>
        </div>
        <div class="monthly-wrapper" id="monthlyContainer"></div>
      </div>

      <div id="page-productlogs" class="page-section">
        <div class="card" style="padding:0; overflow:hidden;">
          <div style="padding: 20px; border-bottom: 1px solid var(--border);">
             <h2 style="margin:0;"><i class="fa-solid fa-boxes-packing"></i> 전체 상품 수정 내역</h2>
             <p style="color:#6b7280; margin:5px 0 0 0; font-size:14px;">업무일지에 기록된 모든 상품 수정 내역을 날짜순으로 보여줍니다.</p>
          </div>
          <table class="timeline-table">
            <thead><tr><th width="150">날짜</th><th>수정 내역</th></tr></thead>
            <tbody id="productLogList"></tbody>
          </table>
        </div>
      </div>

      <div id="page-notes" class="page-section">
          <div class="note-container">
            <div class="note-header">
                <div class="note-left">
                    <h2>📝 업무 노트</h2>
                    <div class="note-search-area">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="noteSearchInput" class="note-search-input" placeholder="내용 검색..." oninput="searchNotes()">
                        <div id="noteSearchResults"></div>
                    </div>
                    <div class="date-selector"><input type="date" id="noteDate" onchange="handleNoteDateChange()"></div>
                    <span id="noteSaveStatus" class="status-badge">로드 완료</span>
                </div>
                <div class="note-btns">
                    <button class="btn-note btn-reset" onclick="resetNoteToOriginal()"><i class="fa-solid fa-rotate-left"></i> 수정 취소</button>
                    <button class="btn-note btn-print" onclick="window.print()"><i class="fa-solid fa-print"></i> 인쇄</button>
                    <button class="btn-note btn-save-note" onclick="saveNoteToServer()"><i class="fa-solid fa-cloud-arrow-up"></i> 서버 저장</button>
                </div>
            </div>
            <div id="editor-wrapper"><div id="editor"></div></div>
        </div>
      </div>

      <div id="page-ranking" class="page-section">
        <div class="card" style="position: relative;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2>🏆 검색 순위 관리</h2>
                <button id="editModeBtn" onclick="toggleEditMode()">✏️ 편집 모드</button>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="setTab('아이소핑크')">아이소핑크</button>
                <button class="tab" onclick="setTab('스티로폼')">스티로폼</button>
                <button class="tab" onclick="setTab('열반사단열재')">열반사단열재</button>
                <button class="tab" onclick="setTab('단열벽지')">단열벽지</button>
                <button class="tab" onclick="setTab('기타')">기타</button>
            </div>
            <table class="ranking-table">
                <colgroup>
                    <col width="30px"> <col width="90px"> <col width="auto"> <col width="80px"> <col width="150px"> <col width="50px"> <col width="50px"> <col width="50px"> <col width="50px"> <col width="50px"> <col width="50px"> <col width="100px"> <col class="admin-col" width="60px" style="display:none;">
                </colgroup>
                <thead>
                    <tr>
                        <th></th> <th>상품번호</th> 
                        <th><input type="checkbox" id="masterCheck" onclick="toggleAllChecks(this.checked)" style="display:none; vertical-align:middle; margin-right:5px; cursor:pointer;" title="전체 선택/해제"> 상품명</th> 
                        <th>가격</th> <th>키워드</th> <th>변동</th>
                        <th>1주차</th> <th>2주차</th> <th>3주차</th> <th>4주차</th> <th>5주차</th> 
                        <th>비고</th> <th class="admin-col" style="display:none;">관리</th>
                    </tr>
                </thead>
                <tbody id="list"></tbody>
            </table>
            <div class="btn-area" id="adminPanel" style="display:none;">
                <button id="addProdBtn" class="big-btn" onclick="addEmptyRow()">+ 신규 상품(메인) 추가</button>
                <button id="saveBtn" class="big-btn" onclick="saveData()">💾 저장하고 서버에 반영하기</button>
                <button id="resetBtn" class="big-btn" onclick="resetData()">🔄 변경취소 (다시 불러오기)</button>
                <button id="downloadBtn" class="big-btn" onclick="downloadCSV()">📥 엑셀로 백업하기</button>
            </div>
        </div>
      </div>

      <div id="page-sales" class="page-section">
        <div class="card">
            <h2>💰 매출 데이터 분석</h2>
            <div class="tabs">
                <button class="tab active" onclick="setSalesTab('스마트스토어')">스마트스토어</button>
                <button class="tab" onclick="setSalesTab('쿠팡')">쿠팡</button>
            </div>
            <div class="chart-controls">
                <span>📈 차트 옵션: </span>
                <label><input type="checkbox" id="chkTraffic" onchange="renderSales()"> 유입수</label>
                <label><input type="checkbox" id="chkPayCount" onchange="renderSales()"> 결제수</label>
                <label><input type="checkbox" id="chkConv" onchange="renderSales()"> 전환율</label>
            </div>
            <div class="chart-container"><canvas id="salesChart"></canvas></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:30px; margin-bottom:10px;">
                <h3>📅 월별 상세 내역 (최신순)</h3>
                <div class="edit-controls" style="text-align:right;">
                    <button id="editSalesBtn" onclick="toggleSalesEditMode()">✏️ 편집</button>
                    <button id="addSalesRowBtn" onclick="addSalesRow()">+ 다음 달 추가</button>
                    <button id="resetSalesBtn" onclick="resetSalesData()">🔄 초기화</button>
                    <button id="saveSalesBtn" onclick="saveSalesData()">💾 매출 데이터 저장</button>
                    <button id="downloadSalesBtn" onclick="downloadSalesCSV()">📥 엑셀 다운로드</button>
                </div>
            </div>
            <div class="table-scroll-wrapper" style="max-height: 500px;">
                <table class="sales-table-style">
                    <colgroup><col width="90px"><col width="100px"><col width="100px"><col width="90px"><col width="80px"><col width="70px"><col width="80px"><col width="100px"><col width="100px"><col width="60px"></colgroup>
                    <thead>
                        <tr>
                            <th>년월</th> <th>결제금액(원)</th> <th>광고비(원)</th> <th>ROAS</th> 
                            <th>전체유입수</th> <th>결제수</th> <th>전환율</th> 
                            <th class="col-smart">모바일비율</th> <th class="col-smart">환불금액비율</th>
                            <th class="col-coupang" style="display:none;">위너비율</th> <th>관리</th>
                        </tr>
                    </thead>
                    <tbody id="salesList" class="sales-table"></tbody>
                </table>
            </div>
        </div>
      </div>
    </div>
  </main>

  <div id="memoModal" class="modal-overlay">
    <div class="modal-box">
      <h4><i class="fa-solid fa-pen"></i> 비고 입력</h4>
      <input type="text" id="modalInput" placeholder="내용을 입력하세요..." onkeypress="handleEnter(event)">
      <div class="modal-btns">
        <button class="btn-cancel" onclick="closeModal()">취소</button>
        <button class="btn-confirm" onclick="saveMemoFromModal()">확인</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="rankingMemoModal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="modalTitle">메모 관리</span>
            <span class="modal-close" onclick="closeRankingMemoModal()" style="cursor:pointer; font-size:20px;">×</span>
        </div>
        <div class="modal-body" id="memoListArea"></div>
        <div class="modal-footer">
            <input type="text" id="newMemoInput" placeholder="새로운 조치사항 입력...">
            <button id="addMemoBtn" onclick="addNewMemo()">등록</button>
        </div>
    </div>
  </div>

<script src="js/common.js"></script>
<script src="js/tasks.js"></script>
<script src="js/analytics.js"></script>

</body>
</html>